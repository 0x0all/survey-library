var SurveyEditor;!function(e){var t=function(){function e(e){this.data=e}return Object.defineProperty(e.prototype,"survey",{get:function(){return this.data},enumerable:!0,configurable:!0}),e.prototype.startDragNewQuestion=function(t,i,r){this.setData(t,e.dataStart+"questiontype:"+i+",questionname:"+r)},e.prototype.startDragQuestion=function(t,i){this.setData(t,e.dataStart+"questionname:"+i)},e.prototype.startDragCopiedQuestion=function(t,i,r){this.setData(t,e.dataStart+"questionname:"+i,r)},e.prototype.isSurveyDragging=function(t){if(!t)return!1;var i=this.getData(t).text;return i&&0==i.indexOf(e.dataStart)},e.prototype.doDragDropOver=function(e,t){if(e=this.getEvent(e),t&&this.isSurveyDragging(e)&&!this.isSamePlace(e,t)){var i=this.getQuestionIndex(e,t);this.survey.currentPage.koDragging(i)}},e.prototype.doDrop=function(e,t){if(void 0===t&&(t=null),e.stopPropagation&&e.stopPropagation(),this.isSurveyDragging(e)){this.survey.currentPage.koDragging(-1);var i=this.getQuestionIndex(e,t),r=this.getDataInfo(e);if(this.clearData(),r){var s=null,o=r.json;o&&(s=Survey.QuestionFactory.Instance.createQuestion(o.type,name),(new Survey.JsonObject).toObject(o,s),s.name=r.questionname),s||(s=this.survey.getQuestionByName(r.questionname)),!s&&r.questiontype&&(s=Survey.QuestionFactory.Instance.createQuestion(r.questiontype,r.questionname)),s&&this.moveQuestionTo(s,i)}}},e.prototype.getQuestionIndex=function(e,t){var i=this.survey.currentPage;if(!t)return i.questions.length;var r=i.questions.indexOf(t);e=this.getEvent(e);var s=e.currentTarget.clientHeight,o=e.offsetY;return e.hasOwnProperty("layerX")&&(o=e.layerY-e.currentTarget.offsetTop),o>s/2&&r++,r},e.prototype.isSamePlace=function(t,i){var r=e.prevEvent;return r.question!=i||Math.abs(t.clientX-r.x)>5||Math.abs(t.clientY-r.y)>5?(r.question=i,r.x=t.clientX,r.y=t.clientY,!1):!0},e.prototype.getEvent=function(e){return e.originalEvent?e.originalEvent:e},e.prototype.moveQuestionTo=function(e,t){if(null!=e){var i=this.survey.getPageByQuestion(e);i&&i.removeQuestion(e),this.survey.currentPage.addQuestion(e,t)}},e.prototype.getDataInfo=function(t){var i=this.getData(t);if(!i)return null;for(var r=i.text.substr(e.dataStart.length),s=r.split(","),o={json:null},n=0;n<s.length;n++){var a=s[n].split(":");o[a[0]]=a[1]}return o.json=i.json,o},e.prototype.getY=function(e){for(var t=0;e;)t+=e.offsetTop-e.scrollTop+e.clientTop,e=e.offsetParent;return t},e.prototype.setData=function(t,i,r){void 0===r&&(r=null),t.originalEvent&&(t=t.originalEvent),t.dataTransfer&&(t.dataTransfer.setData("Text",i),t.dataTransfer.effectAllowed="copy"),e.dragData={text:i,json:r}},e.prototype.getData=function(t){if(t.originalEvent&&(t=t.originalEvent),t.dataTransfer){var i=t.dataTransfer.getData("Text");i&&(e.dragData.text=i)}return e.dragData},e.prototype.clearData=function(){e.dragData={text:"",json:null};var t=e.prevEvent;t.question=null,t.x=-1,t.y=-1},e.dataStart="surveyjs,",e.dragData={text:"",json:null},e.prevEvent={question:null,x:-1,y:-1},e}();e.DragDropHelper=t}(SurveyEditor||(SurveyEditor={}));var SurveyEditor;!function(e){var t=function(){function e(e){this.onValueChanged=e,this.object=null,this.title=ko.observable()}return Object.defineProperty(e.prototype,"value",{set:function(e){},enumerable:!0,configurable:!0}),e}();e.SurveyPropertyArray=t}(SurveyEditor||(SurveyEditor={}));var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},SurveyEditor;!function(e){var t=function(e){function t(t){e.call(this,t),this.onValueChanged=t,this.koItems=ko.observableArray(),this.value_=[];var i=this;i.onApplyClick=function(){i.Apply()},i.onDeleteClick=function(e){i.koItems.remove(e)},i.onClearClick=function(e){i.koItems.removeAll()},i.onAddClick=function(){i.AddItem()}}return __extends(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.value_},set:function(e){null!=e&&Array.isArray(e)||(e=[]),this.value_=e;for(var t=[],i=0;i<e.length;i++){var r=e[i],s=r,o=null;r.value&&(s=r.value,o=r.text),t.push({koValue:ko.observable(s),koText:ko.observable(o),koHasError:ko.observable(!1)})}this.koItems(t)},enumerable:!0,configurable:!0}),t.prototype.AddItem=function(){this.koItems.push({koValue:ko.observable(),koText:ko.observable(),koHasError:ko.observable(!1)})},t.prototype.Apply=function(){if(!this.hasError()){this.value_=[];for(var e=0;e<this.koItems().length;e++){var t=this.koItems()[e];this.value_.push(t.koText()?{value:t.koValue(),text:t.koText()}:t.koValue())}this.onValueChanged&&this.onValueChanged(this.value_)}},t.prototype.hasError=function(){for(var e=!1,t=0;t<this.koItems().length;t++){var i=this.koItems()[t];i.koHasError(!i.koValue()),e=e||i.koHasError()}return e},t}(e.SurveyPropertyArray);e.SurveyPropertyItemValues=t}(SurveyEditor||(SurveyEditor={}));var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},SurveyEditor;!function(e){var t=function(e){function t(t){e.call(this,t),this.onValueChanged=t;var i=this;this.koItems=ko.observableArray(),this.koSelected=ko.observable(null),this.koPages=ko.observableArray(),this.koQuestions=ko.observableArray(),this.value_=[],this.onDeleteClick=function(){i.koItems.remove(i.koSelected())},this.onAddClick=function(){i.addItem()},this.onApplyClick=function(){i.apply()}}return __extends(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.value_},set:function(e){null!=e&&Array.isArray(e)||(e=[]),this.value_=e;var t=[];this.object&&(this.koPages(this.getNames(this.object.pages)),this.koQuestions(this.getNames(this.object.getAllQuestions())));for(var r=0;r<e.length;r++)t.push(new i(e[r],this.koPages,this.koQuestions));this.koItems(t),this.koSelected(t.length>0?t[0]:null)},enumerable:!0,configurable:!0}),t.prototype.apply=function(){this.value_=[];for(var e=this.koItems(),t=0;t<e.length;t++)this.value_.push(e[t].createTrigger());this.onValueChanged&&this.onValueChanged(this.value_)},t.prototype.getNames=function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i];r.name&&t.push(r.name)}return t},t.prototype.addItem=function(){var e=new i(new Survey.SurveyTriggerVisible,this.koPages,this.koQuestions);this.koItems.push(e),this.koSelected(e)},t}(e.SurveyPropertyArray);e.SurveyPropertyTriggers=t;var i=function(){function e(e,t,i){this.availableOperators=[{name:"empty",text:"is empty"},{name:"notempty",text:"is not empty"},{name:"equal",text:"equals"},{name:"notequal",text:"not equals"},{name:"contains",text:"contains"},{name:"notcontains",text:"not contains"},{name:"greater",text:"greater"},{name:"less",text:"less"},{name:"greaterorequal",text:"greater or equals"},{name:"lessorequal",text:"Less or Equals"}],this.koName=ko.observable(e.name),this.koOperator=ko.observable(e.operator),this.koValue=ko.observable(e.value),this.pages=new r("Make pages visible:",t(),e.pages),this.questions=new r("Make questions visible:",i(),e.questions);var s=this;this.koRequireValue=ko.computed(function(){return"empty"!=s.koOperator()&&"notempty"!=s.koOperator()}),this.koIsValid=ko.computed(function(){return!s.koName()||s.koRequireValue()&&!s.koValue()?!1:!0}),this.koText=ko.computed(function(){return s.koName(),s.koOperator(),s.koValue(),s.getText()})}return e.prototype.createTrigger=function(){var e=new Survey.SurveyTriggerVisible;return e.name=this.koName(),e.operator=this.koOperator(),e.value=this.koValue(),e.pages=this.pages.koChoosen(),e.questions=this.questions.koChoosen(),e},e.prototype.getText=function(){return this.koIsValid()?"Run if '"+this.koName()+"' "+this.getOperatorText()+this.getValueText():"The trigger is not set"},e.prototype.getOperatorText=function(){for(var e=this.koOperator(),t=0;t<this.availableOperators.length;t++)if(this.availableOperators[t].name==e)return this.availableOperators[t].text;return e},e.prototype.getValueText=function(){return this.koRequireValue()?" "+this.koValue():""},e}();e.SurveyPropertyTrigger=i;var r=function(){function e(e,t,i){this.title=e,this.koChoosen=ko.observableArray(i);for(var r=[],s=0;s<t.length;s++){var o=t[s];i.indexOf(o)<0&&r.push(o)}this.koObjects=ko.observableArray(r),this.koSelected=ko.observable(),this.koChoosenSelected=ko.observable();var n=this;this.onDeleteClick=function(){n.deleteItem()},this.onAddClick=function(){n.addItem()}}return e.prototype.deleteItem=function(){this.changeItems(this.koChoosenSelected(),this.koChoosen,this.koObjects)},e.prototype.addItem=function(){this.changeItems(this.koSelected(),this.koObjects,this.koChoosen)},e.prototype.changeItems=function(e,t,i){t.remove(e),i.push(e),t.sort(),i.sort()},e}();e.SurveyPropertyTriggerObjects=r}(SurveyEditor||(SurveyEditor={}));var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},SurveyEditor;!function(e){var t=function(t){function r(i){t.call(this,i),this.onValueChanged=i,this.availableValidators=[],this.validatorsClasses=[];var r=this;this.selectedObjectEditor=new e.SurveyObjectEditor,this.selectedObjectEditor.onPropertyValueChanged.add(function(e,t){r.onPropertyValueChanged(t.property,t.object,t.newValue)}),this.koItems=ko.observableArray(),this.koSelected=ko.observable(null),this.koSelected.subscribe(function(e){r.selectedObjectEditor.selectedObject=null!=e?e.validator:null}),this.validatorsClasses=Survey.JsonObject.metaData.getChildrenClasses("surveyvalidator",!0),this.availableValidators=this.getAvailableValidators(),this.value_=[],this.onDeleteClick=function(){r.koItems.remove(r.koSelected())},this.onAddClick=function(e){r.addItem(e)},this.onApplyClick=function(){r.apply()}}return __extends(r,t),Object.defineProperty(r.prototype,"value",{get:function(){return this.value_},set:function(e){null!=e&&Array.isArray(e)||(e=[]),this.value_=e;for(var t=[],r=new Survey.JsonObject,s=0;s<e.length;s++){var o=Survey.JsonObject.metaData.createClass(e[s].getType());r.toObject(e[s],o),t.push(new i(o))}this.koItems(t),this.koSelected(t.length>0?t[0]:null)},enumerable:!0,configurable:!0}),r.prototype.apply=function(){this.value_=[];for(var e=this.koItems(),t=0;t<e.length;t++)this.value_.push(e[t].validator);this.onValueChanged&&this.onValueChanged(this.value_)},r.prototype.addItem=function(e){var t=new i(Survey.JsonObject.metaData.createClass(e));this.koItems.push(t),this.koSelected(t)},r.prototype.getAvailableValidators=function(){for(var e=[],t=0;t<this.validatorsClasses.length;t++)e.push(this.validatorsClasses[t].name);return e},r.prototype.onPropertyValueChanged=function(e,t,i){null!=this.koSelected()&&(this.koSelected().validator[e.name]=i)},r}(e.SurveyPropertyArray);e.SurveyPropertyValidators=t;var i=function(){function e(e){this.validator=e,this.text=e.getType()}return e}();e.SurveyPropertyValidatorItem=i}(SurveyEditor||(SurveyEditor={}));var SurveyEditor;!function(e){!function(e){e[e.Unknown=0]="Unknown",e[e.Survey=1]="Survey",e[e.Page=2]="Page",e[e.Question=3]="Question"}(e.ObjType||(e.ObjType={}));var t=e.ObjType,i=function(){function e(){}return e.getNewName=function(e,t){for(var i={},r=0;r<e.length;r++)i[e[r].name]=!0;for(var s=1;;){if(!i[t+s.toString()])break;s++}return t+s.toString()},e.getObjectType=function(e){return e&&e.getType?"page"==e.getType()?t.Page:"survey"==e.getType()?t.Survey:e.koValue?t.Question:t.Unknown:t.Unknown},e.getObjectName=function(i){if(i.name)return i.name;var r=e.getObjectType(i);if(r!=t.Page)return"";var s=i.data,o=s.pages.indexOf(i);return"[Page "+(o+1)+"]"},e}();e.SurveyHelper=i}(SurveyEditor||(SurveyEditor={}));var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},SurveyEditor;!function(e){var t=function(t){function i(e){t.call(this,e),this.onValueChanged=e,this.koItems=ko.observableArray(),this.value_=[];var i=this;i.onApplyClick=function(){i.Apply()},i.onDeleteClick=function(e){i.koItems.remove(e)},i.onAddClick=function(){i.AddItem()}}return __extends(i,t),Object.defineProperty(i.prototype,"value",{get:function(){return this.value_},set:function(e){null!=e&&Array.isArray(e)||(e=[]),this.value_=e;for(var t=[],i=0;i<e.length;i++){var r=e[i],s={koName:ko.observable(r.name),koTitle:ko.observable(r.title)};this.createValidatorsEditor(s,r.validators),t.push(s)}this.koItems(t)},enumerable:!0,configurable:!0}),i.prototype.AddItem=function(){for(var t=[],i=this.koItems(),r=0;r<i.length;r++)t.push({name:i[r].koName()});var s={koName:ko.observable(e.SurveyHelper.getNewName(t,"text")),koTitle:ko.observable()};this.createValidatorsEditor(s,[]),this.koItems.push(s)},i.prototype.Apply=function(){this.value_=[];for(var e=0;e<this.koItems().length;e++){var t=this.koItems()[e],i=new Survey.MultipleTextItem(t.koName(),t.koTitle());i.validators=t.validators,this.value_.push(i)}this.onValueChanged&&this.onValueChanged(this.value_)},i.prototype.createValidatorsEditor=function(t,i){t.validators=i.slice();var r=function(e){t.validators=e,t.koText("[ Items: "+e.length+" ]")};t.arrayEditor=new e.SurveyPropertyValidators(function(e){r(e)}),t.arrayEditor.object=t,t.arrayEditor.title("Edit property 'Validators'"),t.arrayEditor.value=t.validators,t.koText=ko.observable("[ Items: "+i.length+" ]")},i}(e.SurveyPropertyArray);e.SurveyPropertyTextItems=t}(SurveyEditor||(SurveyEditor={}));var SurveyEditor;!function(e){var t=function(){function t(t,i){void 0===i&&(i=null),this.property=t,this.name=this.property.name,this.koValue=ko.observable(),this.editorType=t.type,this.choices=t.choices,null!=this.choices&&(this.editorType="dropdown");var r=this;this.arrayEditor=null;var s=function(e){r.koValue(e)};this.modalName="modelEditor"+this.editorType+this.name,this.modalNameTarget="#"+this.modalName,"itemvalues"==this.editorType&&(this.arrayEditor=new e.SurveyPropertyItemValues(function(e){s(e)})),"triggers"==this.editorType&&(this.arrayEditor=new e.SurveyPropertyTriggers(function(e){s(e)})),"validators"==this.editorType&&(this.arrayEditor=new e.SurveyPropertyValidators(function(e){s(e)})),"textitems"==this.editorType&&(this.arrayEditor=new e.SurveyPropertyTextItems(function(e){s(e)})),this.baseEditorType=null!=this.arrayEditor?"array":this.editorType,this.koValue.subscribe(function(e){null!=r.object&&r.object[r.name]!=e&&(null==i||r.isValueUpdating||i(r,e))}),this.koText=ko.computed(function(){return r.getValueText(r.koValue())}),this.koIsDefault=ko.computed(function(){return r.property.isDefaultValue(r.koValue())})}return Object.defineProperty(t.prototype,"object",{get:function(){return this.objectValue},set:function(e){this.objectValue=e,this.updateValue()},enumerable:!0,configurable:!0}),t.prototype.updateValue=function(){this.isValueUpdating=!0,this.koValue(this.getValue()),this.arrayEditor&&(this.arrayEditor.object=this.object,this.arrayEditor.title("Edit property '"+this.property.name+"'"),this.arrayEditor.value=this.koValue()),this.isValueUpdating=!1},t.prototype.getValue=function(){return this.property.hasToUseGetValue?this.property.getValue(this.object):this.object[this.name]},t.prototype.getValueText=function(e){return null!=e&&Array.isArray(e)?"[ Items: "+e.length+" ]":e},t}();e.SurveyObjectProperty=t}(SurveyEditor||(SurveyEditor={}));var SurveyEditor;!function(e){var t=function(){function t(){this.onPropertyValueChanged=new Survey.Event,this.koProperties=ko.observableArray(),this.koActiveProperty=ko.observable(),this.koHasObject=ko.observable()}return Object.defineProperty(t.prototype,"selectedObject",{get:function(){return this.selectedObjectValue},set:function(e){this.selectedObjectValue!=e&&(this.koHasObject(null!=e),this.selectedObjectValue=e,this.updateProperties(),this.updatePropertiesObject())},enumerable:!0,configurable:!0}),t.prototype.getPropertyEditor=function(e){for(var t=this.koProperties(),i=0;i<t.length;i++)if(t[i].name==e)return t[i];return null},t.prototype.changeActiveProperty=function(e){this.koActiveProperty(e)},t.prototype.ObjectChanged=function(){this.updatePropertiesObject()},t.prototype.updateProperties=function(){var t=this;if(!this.selectedObject||!this.selectedObject.getType)return this.koProperties([]),void this.koActiveProperty(null);var i=Survey.JsonObject.metaData.getProperties(this.selectedObject.getType());i.sort(function(e,t){return e.name==t.name?0:e.name>t.name?1:-1});for(var r=[],s=this,o=function(e,i){s.onPropertyValueChanged.fire(t,{property:e.property,object:e.object,newValue:i})},n=0;n<i.length;n++)if(this.canShowProperty(i[n])){var a=new e.SurveyObjectProperty(i[n],o);r.push(a)}this.koProperties(r),this.koActiveProperty(this.getPropertyEditor("name"))},t.prototype.canShowProperty=function(e){var t=e.name;return"questions"==t||"pages"==t?!1:!0},t.prototype.updatePropertiesObject=function(){for(var e=this.koProperties(),t=0;t<e.length;t++)e[t].object=this.selectedObject},t}();e.SurveyObjectEditor=t}(SurveyEditor||(SurveyEditor={}));var SurveyEditor;!function(e){var t=function(){function t(e,t,i){void 0===e&&(e=null),void 0===t&&(t=null),void 0===i&&(i=null),this.draggingPage=null,this.koPages=ko.observableArray(),this.koIsValid=ko.observable(!1),this.onAddNewPageCallback=e,this.onSelectPageCallback=t,this.onMovePageCallback=i;var r=this;this.selectPageClick=function(e){r.onSelectPageCallback&&r.onSelectPageCallback(e.page)},this.dragStart=function(e){r.draggingPage=e},this.dragOver=function(e){},this.dragEnd=function(){r.draggingPage=null},this.dragDrop=function(e){r.moveDraggingPageTo(e)}}return Object.defineProperty(t.prototype,"survey",{get:function(){return this.surveyValue},set:function(e){this.surveyValue=e,this.koIsValid(null!=this.surveyValue),this.updatePages()},enumerable:!0,configurable:!0}),t.prototype.setSelectedPage=function(e){for(var t=this.koPages(),i=0;i<t.length;i++)t[i].koSelected(t[i].page==e)},t.prototype.addNewPageClick=function(){this.onAddNewPageCallback&&this.onAddNewPageCallback()},t.prototype.removePage=function(e){var t=this.getIndexByPage(e);t>-1&&this.koPages.splice(t,1)},t.prototype.changeName=function(t){var i=this.getIndexByPage(t);i>-1&&this.koPages()[i].title(e.SurveyHelper.getObjectName(t))},t.prototype.getIndexByPage=function(e){for(var t=this.koPages(),i=0;i<t.length;i++)if(t[i].page==e)return i;return-1},t.prototype.updatePages=function(){if(null==this.surveyValue)return void this.koPages([]);for(var t=[],i=0;i<this.surveyValue.pages.length;i++){var r=this.surveyValue.pages[i];t.push({title:ko.observable(e.SurveyHelper.getObjectName(r)),page:r,koSelected:ko.observable(!1)})}this.koPages(t)},t.prototype.moveDraggingPageTo=function(e){if(null==e||e==this.draggingPage)return void(this.draggingPage=null);if(null!=this.draggingPage){var t=this.koPages().indexOf(this.draggingPage),i=this.koPages().indexOf(e);this.onMovePageCallback&&this.onMovePageCallback(t,i)}},t}();e.SurveyPagesEditor=t}(SurveyEditor||(SurveyEditor={}));var SurveyEditor;!function(e){var t=(function(){function e(){}return e}(),function(){function t(e){this.text=e,this.text&&""!=this.text.trim()||(this.text="{}"),this.errors=[],this.process()}return Object.defineProperty(t.prototype,"survey",{get:function(){return this.surveyValue},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isJsonCorrect",{get:function(){return null!=this.surveyValue},enumerable:!0,configurable:!0}),t.prototype.process=function(){try{this.jsonValue=new e.SurveyJSON5(1).parse(this.text)}catch(t){this.errors.push({pos:{start:t.at,end:-1},text:t.message})}if(null!=this.jsonValue&&(this.updateJsonPositions(this.jsonValue),this.surveyValue=new Survey.Survey(this.jsonValue),null!=this.surveyValue.jsonErrors))for(var i=0;i<this.surveyValue.jsonErrors.length;i++){var t=this.surveyValue.jsonErrors[i];this.errors.push({pos:{start:t.at,end:-1},text:t.getFullDescription()})}this.surveyObjects=this.createSurveyObjects(),this.setEditorPositionByChartAt(this.surveyObjects),this.setEditorPositionByChartAt(this.errors)},t.prototype.updateJsonPositions=function(e){e.pos.self=e;for(var t in e){var i=e[t];i&&i.pos&&(e.pos[t]=i.pos,this.updateJsonPositions(i))}},t.prototype.createSurveyObjects=function(){var e=[];if(null==this.surveyValue)return e;this.isSurveyAsPage=!1;for(var t=0;t<this.surveyValue.pages.length;t++){var i=this.surveyValue.pages[t];0!=t||i.pos||(i.pos=this.surveyValue.pos,this.isSurveyAsPage=!0),e.push(i);for(var r=0;r<i.questions.length;r++)e.push(i.questions[r])}return e},t.prototype.setEditorPositionByChartAt=function(e){if(null!=e&&0!=e.length)for(var t={row:0,column:0},i=this.getAtArray(e),r=0,s=0;s<i.length;s++){var o=i[s].at;t=this.getPostionByChartAt(t,r,o);var n=i[s].obj;n.position||(n.position={}),o==n.pos.start?n.position.start=t:o==n.pos.end&&(n.position.end=t),r=o}},t.prototype.getPostionByChartAt=function(e,i,r){for(var s={row:e.row,column:e.column},o=i;r>o;)this.text.charAt(o)==t.newLineChar?(s.row++,s.column=0):s.column++,o++;return s},t.prototype.getAtArray=function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i],s=r.pos;s&&(t.push({at:s.start,obj:r}),s.end>0&&t.push({at:s.end,obj:r}))}return t.sort(function(e,t){return e.at>t.at?1:e.at<t.at?-1:0})},t}());e.SurveyTextWorker=t}(SurveyEditor||(SurveyEditor={}));var SurveyEditor;!function(e){var t=function(){function t(){this.surveyId=null,this.surveyPostId=null;var e=this;this.koShowAsWindow=ko.observable("page"),this.koScriptUsing=ko.observable("bootstrap"),this.koHasIds=ko.observable(!1),this.koLoadSurvey=ko.observable(!1),this.koShowAsWindow.subscribe(function(t){e.surveyEmbedingJava.setValue(e.getJavaText())}),this.koScriptUsing.subscribe(function(t){e.setHeadText()}),this.koLoadSurvey.subscribe(function(t){e.surveyEmbedingJava.setValue(e.getJavaText())}),this.surveyEmbedingHead=null}return Object.defineProperty(t.prototype,"json",{get:function(){return this.jsonValue},set:function(e){this.jsonValue=e},enumerable:!0,configurable:!0}),t.prototype.show=function(){if(null==this.surveyEmbedingHead){this.surveyEmbedingHead=this.createEditor("surveyEmbedingHead"),this.setHeadText();var e=this.createEditor("surveyEmbedingBody");e.setValue('<div id= "mySurveyJSName" ></div>'),this.surveyEmbedingJava=this.createEditor("surveyEmbedingJava")}this.koHasIds(this.surveyId&&this.surveyPostId),this.surveyEmbedingJava.setValue(this.getJavaText())},t.prototype.setHeadText=function(){var e='<script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.3.0/knockout-min.js" ></script>\n';this.surveyEmbedingHead.setValue("bootstrap"==this.koScriptUsing()?e+'<script src="js/survey.bootstrap.min.js"></script>':e+'<script src="js/survey.min.js"></script>\n<link href="css/survey.css" type="text/css" rel="stylesheet" />')},t.prototype.createEditor=function(e){var t=ace.edit(e);return t.setTheme("ace/theme/monokai"),t.session.setMode("ace/mode/json"),t.setShowPrintMargin(!1),t.renderer.setShowGutter(!1),t.setReadOnly(!0),t},t.prototype.getJavaText=function(){var e="page"==this.koShowAsWindow(),t=e?"var survey = new Survey.Survey(\n":"var surveyWindow = new Survey.SurveyWindow(\n";t+=this.getJsonText(),t+=");\n",e||(t+="surveyWindow.");var i='alert("The results are:" + JSON.stringify(s.data));';return this.koHasIds()&&(i="survey.sendResult('"+this.surveyPostId+"');"),t+="survey.onComplete.add(function (s) {\n"+i+"\n });\n",e?t+='survey.render("mySurveyJSName");':(t+="//By default Survey.title is used.\n",t+='//surveyWindow.title = "My Survey Window Title.";\n',t+="surveyWindow.show();"),t},t.prototype.getJsonText=function(){return this.koHasIds()&&this.koLoadSurvey()?"{ surveyId: '"+this.surveyId+"'}":(new e.SurveyJSON5).stringify(this.json)},t}();e.SurveyEmbedingWindow=t}(SurveyEditor||(SurveyEditor={}));var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},SurveyEditor;!function(e){var t=function(){function t(){this.koVerbs=ko.observableArray(),this.koHasVerbs=ko.observable();var e=Survey.JsonObject.metaData.getChildrenClasses("selectbase",!0);this.choicesClasses=[];for(var t=0;t<e.length;t++)this.choicesClasses.push(e[t].name)}return Object.defineProperty(t.prototype,"survey",{get:function(){return this.surveyValue},set:function(e){this.survey!=e&&(this.surveyValue=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"obj",{get:function(){return this.objValue},set:function(e){this.objValue!=e&&(this.objValue=e,this.buildVerbs())},enumerable:!0,configurable:!0}),t.prototype.buildVerbs=function(){var t=[],i=e.SurveyHelper.getObjectType(this.obj);if(i==e.ObjType.Question){var o=this.obj;this.survey.pages.length>1&&t.push(new s(this.survey,o)),this.choicesClasses.indexOf(o.getType())>-1&&t.push(new r(this.survey,o))}this.koVerbs(t),this.koHasVerbs(t.length>0)},t}();e.SurveyVerbs=t;var i=function(){function e(e,t){this.survey=e,this.question=t,this.koItems=ko.observableArray(),this.koSelectedItem=ko.observable()}return Object.defineProperty(e.prototype,"text",{get:function(){return""},enumerable:!0,configurable:!0}),e}();e.SurveyVerbItem=i;var r=function(e){function t(t,i){e.call(this,t,i),this.survey=t,this.question=i;for(var r=Survey.JsonObject.metaData.getChildrenClasses("selectbase",!0),s=[],o=0;o<r.length;o++)s.push({value:r[o].name,text:r[o].name});this.koItems(s),this.koSelectedItem(i.getType());var n=this;this.koSelectedItem.subscribe(function(e){n.changeType(e)})}return __extends(t,e),Object.defineProperty(t.prototype,"text",{get:function(){return"Change type "},enumerable:!0,configurable:!0}),t.prototype.changeType=function(e){if(e!=this.question.getType()){var t=this.survey.getPageByQuestion(this.question),i=t.questions.indexOf(this.question),r=Survey.QuestionFactory.Instance.createQuestion(e,this.question.name),s=new Survey.JsonObject,o=s.toJsonObject(this.question);s.toObject(o,r),t.removeQuestion(this.question),t.addQuestion(r,i)}},t}(i);e.SurveyVerbChangeTypeItem=r;var s=function(t){function i(i,r){t.call(this,i,r),this.survey=i,this.question=r;for(var s=[],o=0;o<this.survey.pages.length;o++){var n=this.survey.pages[o];s.push({value:n,text:e.SurveyHelper.getObjectName(n)})}this.koItems(s),this.prevPage=this.survey.getPageByQuestion(r),this.koSelectedItem(this.prevPage);var a=this;this.koSelectedItem.subscribe(function(e){a.changePage(e)})}return __extends(i,t),Object.defineProperty(i.prototype,"text",{get:function(){return"Change page "},enumerable:!0,configurable:!0}),i.prototype.changePage=function(e){null!=e&&e!=this.prevPage&&(this.prevPage.removeQuestion(this.question),e.addQuestion(this.question))},i}(i);e.SurveyVerbChangePageItem=s}(SurveyEditor||(SurveyEditor={}));var templateEditor;!function(e){var t;!function(e){e.html='<div class="row nav-tabs">    <div class="col-md-3">        <nav class="navbar-default">            <ul class="nav nav-tabs no-borders">                <li data-bind="css: {active: koIsShowDesigner()}"><a href="#" data-bind="click:selectDesignerClick">Designer</a></li>                <li data-bind="css: {active: !koIsShowDesigner()}"><a href="#" data-bind="click:selectEditorClick">JSON Editor</a></li>            </ul>        </nav>    </div>    <div class="col-md-9 svd_navbarbuttons">        <nav class="navbar-default pull-right">            <div class="btn-toolbar" role="toolbar">                <button type="button" class="btn btn-default" data-bind="click: runSurveyClick" data-toggle="modal" data-target="#surveyExampleModal"><span class="glyphicon glyphicon-play" aria-hidden="true"></span>  Run Survey</button>                <button type="button" class="btn btn-default" data-bind="click: embedingSurveyClick" data-toggle="modal" data-target="#surveyEmbedingModal">Embeding Survey to Your Page</button>                <button type="button" class="btn btn-default" data-bind="visible: koShowSaveButton, click: saveButtonClick">Save Survey</button>            </div>        </nav>    </div></div><div class="panel" style="width:100%">    <div id="surveyjsEditor" data-bind="visible: !koIsShowDesigner()" style="height:450px;width:100%"></div>    <div class="row" data-bind="visible: koIsShowDesigner()">        <div class="row col-md-9">            <div class="col-md-3">                <div class="panel panel-default" style="width:100%">                    <div class="panel-heading">                        <b>Toolbox</b>                    </div>                    <div class="btn-group-vertical" style="width:100%;padding-right:2px">                        <!-- ko foreach: questionTypes -->                        <div class="btn btn-default" style="text-align:left; padding-left:10px; margin:1px;width:100%" draggable="true" data-bind="click: $parent.clickQuestion, event:{dragstart: function(el, e) { $parent.draggingQuestion($data, e); return true;}}">                            <span data-bind="text:$data"></span>                        </div>                        <!-- /ko  -->                        <!-- ko foreach: koCopiedQuestions -->                        <div class="btn btn-primary" style="text-align:left; padding-left:10px; margin:1px;width:100%" draggable="true" data-bind="click: $parent.clickCopiedQuestion, event:{dragstart: function(el, e) { $parent.draggingCopiedQuestion($data, e); return true;}}">                            <span data-bind="text:name"></span>                        </div>                        <!-- /ko  -->                    </div>                </div>            </div>            <div class="col-md-9">                <div data-bind="template: { name: \'pageeditor\', data: pagesEditor }"></div>                <div style="overflow-y: scroll;height:450px;">                    <div id="surveyjs" style="width:100%"></div>                </div>            </div>        </div>        <div class="col-md-3">            <div class="panel panel-default" style="width:100%">                <div class="panel-heading">                    <div class="input-group">                        <select class="form-control" data-bind="options: koObjects, optionsText: \'text\', value: koSelectedObject"></select>                        <span class="input-group-btn">                            <button class="btn btn-default" type="button" data-bind="enable: koCanDeleteObject, click: deleteCurrentObject" title="Delete selected object"><span class="glyphicon glyphicon-remove"></span></button>                        </span>                    </div>                </div>                <div data-bind="template: { name: \'objecteditor\', data: selectedObjectEditor }"></div>                <div class="panel-footer" data-bind="visible:surveyVerbs.koHasVerbs">                    <div data-bind="template: { name: \'objectverbs\', data: surveyVerbs }"></div>                </div>            </div>        </div>    </div></div><div id="surveyExampleModal" class="modal fade" role="dialog">    <div class="modal-dialog">        <div class="modal-content">            <div class="modal-header">                <button type="button" class="close" data-dismiss="modal">&times;</button>                <h4 class="modal-title">Running survey</h4>            </div>            <div class="modal-body">                <div id="surveyjsExample"></div>            </div>        </div>    </div></div><div id="surveyEmbedingModal" class="modal fade" role="dialog">    <div class="modal-dialog">        <div class="modal-content">            <div class="modal-header">                <button type="button" class="close" data-dismiss="modal">&times;</button>                <h4 class="modal-title">Embeding survey</h4>            </div>            <div class="modal-body">                <div data-bind="template: { name: \'surveyembeding\', data: surveyEmbeding }"></div>            </div>        </div>    </div></div><script type="text/html" id="objecteditor">    <table class="table svd_table-nowrap">        <tbody data-bind="foreach: koProperties">            <tr data-bind="click: $parent.changeActiveProperty($data), css: {\'active\': $parent.koActiveProperty() == $data}">                <td data-bind="text: name" width="50%"></td>                <td width="50%">                    <span data-bind="text: koText, visible: $parent.koActiveProperty() != $data, attr: {title: koText}, style: {color: koIsDefault() ? \'gray\' : \'\'}" style="text-overflow:ellipsis;white-space:nowrap;overflow:hidden"></span>                    <div data-bind="visible: $parent.koActiveProperty() == $data">                        <!-- ko template: { name: \'propertyeditor-\' + baseEditorType, data: $data } -->                        <!-- /ko -->                    </div>                </td>            </tr>        </tbody>    </table></script><script type="text/html" id="objectverbs">    <!-- ko foreach: koVerbs -->        <div class="row">            <div class="input-group">                <span  class="input-group-addon" data-bind="text:text"></span>                <select class="form-control" data-bind="options: koItems, optionsText: \'text\', optionsValue:\'value\', value: koSelectedItem"></select>            </div>        </div>    <!-- /ko  --></script><script type="text/html" id="pageeditor">    <ul class="nav nav-tabs">        <!-- ko foreach: koPages -->        <li data-bind="css: {active: koSelected()},event:{           dragstart:function(el, e){ $parent.dragStart(el); return true; },           dragover:function(el, e){ $parent.dragOver(el);},           dragend:function(el, e){ $parent.dragEnd();},           drop:function(el, e){ $parent.dragDrop(el);}         }">             <a href="#" data-bind="click:$parent.selectPageClick">                <span data-bind="text: title"></span>            </a>        </li>        <!-- /ko  -->        <li><button type="button" class="btn btn-default" data-bind="click:addNewPageClick"><span class="glyphicon glyphicon-plus"></span></button></li>    </ul></script><script type="text/html" id="propertyeditor-array">    <div>        <span data-bind="text: koText"></span>        <button type="button" class="btn btn-default" data-toggle="modal" data-bind="attr: {\'data-target\' : modalNameTarget}">Edit</button>    </div>    <div data-bind="attr: {id : modalName}" class="modal fade" role="dialog">        <div class="modal-dialog">            <div class="modal-content">                <div class="modal-header">                    <button type="button" class="close" data-dismiss="modal">&times;</button>                    <h4 class="modal-title" data-bind="text:arrayEditor.title"></h4>                </div>                <div class="modal-body svd_notopbottompaddings">                    <!-- ko template: { name: \'propertyeditor-\' + editorType, data: arrayEditor } -->                    <!-- /ko -->                </div>                <div class="modal-footer">                    <input type="button" value="Apply" data-bind="click: arrayEditor.onApplyClick" style="width:100px" />                    <input type="button" data-dismiss="modal" value="Close" style="width:100px" />                </div>            </div>        </div>    </div></script><script type="text/html" id="propertyeditor-boolean">    <input type="checkbox" data-bind="checked: koValue" /></script><script type="text/html" id="propertyeditor-dropdown">    <select data-bind="value: koValue, options: choices"  style="width:100%"></select></script><script type="text/html" id="propertyeditor-itemvalues"><table class="table">    <thead>        <tr>            <th>Value</th>            <th>Text</th>            <th></th>        </tr>    </thead>    <tbody>        <!-- ko foreach: koItems -->        <tr>            <td>                <input type="text" data-bind="value:koValue" style="width:200px" />                <div class="alert alert-danger no-padding" role="alert" data-bind="visible:koHasError">Please, enter the value.</div>            </td>            <td><input type="text" data-bind="value:koText" style="width:200px" /></td>            <td><input type="button" data-bind="click: $parent.onDeleteClick" value="Delete" /></td>        </tr>        <!-- /ko -->        <tr>            <td colspan="3">                <div class="row btn-toolbar">                    <input type="button" data-bind="click: onAddClick" value="Add New" />                    <input type="button" data-bind="click: onClearClick" value="Remove All" />                </div>            </td>        </tr>    </tbody></table></script><script type="text/html" id="propertyeditor-number">    <input type="number" data-bind="value: koValue" style="width:100%" /></script><script type="text/html" id="propertyeditor-string">    <input type="text" data-bind="value: koValue" style="width:100%" /></script><script type="text/html" id="propertyeditor-textitems"><div class="panel">    <table class="table">        <thead>            <tr>                <th>Name</th>                <th>Title</th>                <th></th>            </tr>        </thead>        <tbody>            <!-- ko foreach: koItems -->            <tr>                <td><input type="text" data-bind="value:koName" style="width:200px" /></td>                <td><input type="text" data-bind="value:koTitle" style="width:200px" /></td>                <td><input type="button" data-bind="click: $parent.onDeleteClick" value="Delete" /></td>            </tr>            <!-- /ko -->            <tr>                <td colspan="4"><input type="button" data-bind="click: onAddClick" value="Add" /></td>            </tr>        </tbody>    </table></div></script><script type="text/html" id="propertyeditor-triggers"><div class="panel">    <div class="panel-heading">        <div class="row input-group">            <span class="input-group-btn">                <button type="button" data-bind="enable: koQuestions().length > 0, click: onAddClick" class="btn btn-default"><span class="glyphicon glyphicon-plus"></span></button>            </span>            <select class="form-control" data-bind="options: koItems, optionsText: \'koText\', value: koSelected"></select>            <span class="input-group-btn">                <button type="button" data-bind="enable: koSelected() != null, click: onDeleteClick" class="btn btn-default"><span class="glyphicon glyphicon-remove"></span></button>            </span>        </div>    </div>    <div data-bind="visible: koSelected() == null">        <div data-bind="visible: koQuestions().length == 0">            There is no any question in the survey.        </div>        <div data-bind="visible: koQuestions().length > 0">            Please create a trigger        </div>    </div>    <div data-bind="visible: koSelected() != null">        <div class="row" data-bind="with: koSelected">            <div class="form-inline col-sm-12">                <span>On </span><select class="form-control" data-bind="options:$parent.koQuestions, value: koName"></select> <span> </span>                <select class="form-control" data-bind="options:availableOperators, optionsValue: \'name\', optionsText: \'text\', value:koOperator"></select>                <input class="form-control" style="padding: 0" type="text" data-bind="visible: koRequireValue, value:koValue" />            </div>            <div class="row">                <div class="col-sm-6">                    <!-- ko template: { name: \'propertyeditor-triggersitems\', data: pages } -->                    <!-- /ko -->                </div>                <div class="col-sm-6">                    <!-- ko template: { name: \'propertyeditor-triggersitems\', data: questions } -->                    <!-- /ko -->                </div>            </div>        </div>    </div></div></script><script type="text/html" id="propertyeditor-triggersitems">    <div class="panel no-margins no-padding">        <div class="panel-heading">            <span data-bind="text: title"></span>        </div>        <div class="input-group">            <select class="form-control" multiple="multiple" data-bind="options:koChoosen, value: koChoosenSelected"></select>            <span class="input-group-btn" style="vertical-align:top">                <button type="button" data-bind="enable: koChoosenSelected() != null, click: onDeleteClick" class="btn btn-default"><span class="glyphicon glyphicon-remove"></span></button>            </span>        </div>        <div class="input-group" style="margin-top:5px">            <select class="form-control" data-bind="options:koObjects, value: koSelected"></select>            <span class="input-group-btn">                <button type="button" data-bind="enable: koSelected() != null, click: onAddClick" style="width:40px" class="btn btn-default"><span class="glyphicon glyphicon-plus"></span></button>            </span>        </div>    </div></script><script type="text/html" id="propertyeditor-validators"><div class="panel">    <div class="panel-heading">        <div class="row input-group">            <button type="button" class="dropdown-toggle input-group-addon" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">                <span class="glyphicon glyphicon-plus"></span>            </button>            <ul class="dropdown-menu input-group">                <!-- ko foreach: availableValidators -->                <li><a href="#" data-bind="click: $parent.onAddClick($data)"><span data-bind="text:$data"></span></a></li>                <!-- /ko  -->            </ul>            <select class="form-control" data-bind="options: koItems, optionsText: \'text\', value: koSelected"></select>            <span class="input-group-btn">                <button type="button" data-bind="enable: koSelected() != null, click: onDeleteClick" class="btn btn-default"><span class="glyphicon glyphicon-remove"></span></button>            </span>        </div>    </div>    <div data-bind="template: { name: \'objecteditor\', data: selectedObjectEditor }"></div></div></script><script type="text/html" id="surveyembeding">    <div class="row">        <select data-bind="value:koScriptUsing">            <option value="bootstrap">For bootstrap framework</option>            <option value="standard">No bootstrap</option>        </select>        <select data-bind="value:koShowAsWindow">            <option value="page">Use Survey Inside a Page</option>            <option value="window">Use Survey as a Window</option>        </select>        <label class="checkbox-inline" data-bind="visible:koHasIds">            <input type="checkbox" data-bind="checked:koLoadSurvey" />            <span>Load Survey from server</span>        </label>    </div>    <div class="panel">        <div class="panel-heading">Scripts and styles</div>        <div id="surveyEmbedingHead" style="height:70px;width:100%"></div>    </div>    <div class="panel" data-bind="visible: koShowAsWindow()==\'page\'">        <div class="panel-heading">HTML part</div>        <div id="surveyEmbedingBody" style="height:30px;width:100%"></div>    </div>    <div class="panel">        <div class="panel-heading">Java Script</div>        <div id="surveyEmbedingJava" style="height:300px;width:100%"></div>    </div></script>';

}(t=e.ko||(e.ko={}))}(templateEditor||(templateEditor={}));var template_page;!function(e){e.html='<div data-bind="event:{           dragenter:function(el, e){ dragEnter(e);},           dragleave:function(el, e){ dragLeave(e);},           dragover:function(el, e){ return false;},           drop:function(el, e){ dragDrop(e);}}     ">    <h4 data-bind="visible: (title.length > 0) && data.showPageTitles, text: koNo() + title"></h4>    <!-- ko foreach: { data: questions, as: \'question\' } -->    <div class="svd_dragover" data-bind="visible:$parent.koDragging() == $index()"></div>    <!-- ko template: { name: \'survey-question\', data: question } -->    <!-- /ko -->    <!-- /ko -->    <div class="well" data-bind="visible:$root.isDesignMode && questions.length == 0">        <span>Please drop a question here.</span>    </div>    <div class="svd_dragover" data-bind="visible:koDragging() == questions.length"></div></div>'}(template_page||(template_page={}));var template_question;!function(e){e.html='<div class="well well-sm" data-bind="attr : {draggable: $root.isDesignMode}, visible: question.koVisible() || $root.isDesignMode, click: $root.isDesignMode ? koOnClick: null,          event:{           dragstart:function(el, e){ dragStart(e); return true; },           dragover:function(el, e){ dragOver(e);},           drop:function(el, e){ dragDrop(e);}         }, css:{svd_q_design_border: $root.isDesignMode, svd_q_selected : koIsSelected}">    <div class="svd_q_copybutton" data-bind="visible: koIsSelected">        <button class="btn btn-primary btn-xs" data-bind="click: $root.copyQuestionClick">Copy</button>    </div>    <div data-bind="css:{svd_q_design: $root.isDesignMode}">        <div class="alert alert-danger" role="alert" data-bind="visible: koErrors().length > 0, foreach: koErrors">            <div>                <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>                <span data-bind="text:$data.getText()"></span>            </div>        </div>        <!-- ko if: question.hasTitle -->        <h5 data-bind="text: question.koNo() +  (question.isRequired ? question.data.requiredText : \'\') + question.title"></h5>        <!-- /ko -->        <!-- ko template: { name: \'survey-question-\' + question.getType(), data: question } -->        <!-- /ko -->        <div data-bind="visible: question.hasComment">            Other (please describe)            <div data-bind="template: { name: \'survey-comment\', data: {\'question\': question, \'visible\': true } }"></div>        </div>    </div></div>'}(template_question||(template_question={}));var SurveyEditor;!function(e){var t=function(){function t(t){void 0===t&&(t=null),this.surveyId=null,this.surveyPostId=null,this.timeoutId=-1,this.questionTypes=Survey.QuestionFactory.Instance.getAllTypes(),this.koCopiedQuestions=ko.observableArray(),this.koCanDeleteObject=ko.observable(!1);var i=this;this.koShowSaveButton=ko.observable(!1),this.saveButtonClick=function(){i.saveSurveyFunc&&i.saveSurveyFunc()},this.koObjects=ko.observableArray(),this.koSelectedObject=ko.observable(),this.koSelectedObject.subscribe(function(e){i.selectedObjectChanged(null!=e?e.value:null)}),this.surveyObjects=new e.SurveyObjects(this.koObjects,this.koSelectedObject),this.surveyVerbs=new e.SurveyVerbs,this.selectedObjectEditor=new e.SurveyObjectEditor,this.selectedObjectEditor.onPropertyValueChanged.add(function(e,t){i.onPropertyValueChanged(t.property,t.object,t.newValue)}),this.pagesEditor=new e.SurveyPagesEditor(function(){i.addPage()},function(e){i.surveyObjects.selectObject(e)},function(e,t){i.movePage(e,t)}),this.surveyEmbeding=new e.SurveyEmbedingWindow,this.koIsShowDesigner=ko.observable(!0),this.selectDesignerClick=function(){i.showDesigner()},this.selectEditorClick=function(){i.showJsonEditor()},this.runSurveyClick=function(){i.showLiveSurvey()},this.embedingSurveyClick=function(){i.showSurveyEmbeding()},this.deleteObjectClick=function(){i.deleteCurrentObject()},this.draggingQuestion=function(e,t){i.doDraggingQuestion(e,t)},this.clickQuestion=function(e){i.doClickQuestion(e)},this.draggingCopiedQuestion=function(e,t){i.doDraggingCopiedQuestion(e.json,t)},this.clickCopiedQuestion=function(e){i.doClickCopiedQuestion(e.json)},t&&this.render(t)}return Object.defineProperty(t.prototype,"survey",{get:function(){return this.surveyValue},enumerable:!0,configurable:!0}),t.prototype.render=function(e){void 0===e&&(e=null);var t=this;e&&"string"==typeof e&&(e=document.getElementById(e)),e&&(this.renderedElement=e),e=this.renderedElement,e&&(e.innerHTML=templateEditor.ko.html,t.applyBinding())},t.prototype.loadSurvey=function(e){var t=this;(new Survey.dxSurveyService).loadSurvey(e,function(e,i,r){e&&i&&(t.text=JSON.stringify(i))})},Object.defineProperty(t.prototype,"text",{get:function(){return this.koIsShowDesigner()?this.getSurveyTextFromDesigner():null!=this.jsonEditor?this.jsonEditor.getValue():""},set:function(t){this.textWorker=new e.SurveyTextWorker(t),this.textWorker.isJsonCorrect?this.showDesigner():(this.setTextValue(t),this.koIsShowDesigner(!1))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"saveSurveyFunc",{get:function(){return this.saveSurveyFuncValue},set:function(e){this.saveSurveyFuncValue=e,this.koShowSaveButton(null!=e)},enumerable:!0,configurable:!0}),t.prototype.setTextValue=function(e){null!=this.jsonEditor&&(this.isProcessingImmediately=!0,this.jsonEditor.setValue(e),this.jsonEditor.renderer.updateFull(!0),this.processJson(e),this.isProcessingImmediately=!1)},t.prototype.addPage=function(){var t=e.SurveyHelper.getNewName(this.survey.pages,"page"),i=this.surveyValue.addNewPage(t);this.addPageToUI(i)},t.prototype.movePage=function(e,t){var i=this.survey.pages[e];this.deleteObject(i),this.survey.pages.splice(t,0,i),this.addPageToUI(i)},t.prototype.addPageToUI=function(e){this.pagesEditor.survey=this.surveyValue,this.surveyObjects.addPage(e)},t.prototype.onQuestionAdded=function(e){var t=this.survey.getPageByQuestion(e);this.surveyObjects.addQuestion(t,e),this.survey.render()},t.prototype.onQuestionRemoved=function(e){this.surveyObjects.removeObject(e),this.survey.render()},t.prototype.onPropertyValueChanged=function(t,i,r){t.isDefaultValue(r);i[t.name]=r,"name"==t.name&&(this.surveyObjects.nameChanged(i),e.SurveyHelper.getObjectType(i)==e.ObjType.Page&&this.pagesEditor.changeName(i)),this.surveyValue.render()},t.prototype.showDesigner=function(){return this.textWorker.isJsonCorrect?(this.initSurvey((new Survey.JsonObject).toJsonObject(this.textWorker.survey)),void this.koIsShowDesigner(!0)):void alert("Please correct JSON!")},t.prototype.showJsonEditor=function(){this.jsonEditor.setValue(this.getSurveyTextFromDesigner()),this.jsonEditor.focus(),this.koIsShowDesigner(!1)},t.prototype.getSurveyTextFromDesigner=function(){var t=(new Survey.JsonObject).toJsonObject(this.survey);return(new e.SurveyJSON5).stringify(t,null,1)},t.prototype.selectedObjectChanged=function(t){var i=!1;this.selectedObjectEditor.selectedObject=t,this.surveyVerbs.obj=t;var r=e.SurveyHelper.getObjectType(t);r==e.ObjType.Page&&(this.survey.currentPage=t,i=this.survey.pages.length>1),r==e.ObjType.Question?(this.survey.setselectedQuestion(t),i=!0,this.survey.currentPage=this.survey.getPageByQuestion(this.survey.selectedQuestionValue)):this.survey.setselectedQuestion(null),this.koCanDeleteObject(i)},t.prototype.applyBinding=function(){null!=this.renderedElement&&(ko.cleanNode(this.renderedElement),ko.applyBindings(this,this.renderedElement),this.surveyjs=document.getElementById("surveyjs"),this.jsonEditor=ace.edit("surveyjsEditor"),this.surveyjsExample=document.getElementById("surveyjsExample"),this.initSurvey((new e.SurveyJSON5).parse(t.defaultNewSurveyText)),this.surveyValue.mode="designer",this.surveyValue.render(this.surveyjs),this.initJsonEditor(),e.SurveyTextWorker.newLineChar=this.jsonEditor.session.doc.getNewLineCharacter())},t.prototype.initJsonEditor=function(){var e=this;this.jsonEditor.setTheme("ace/theme/monokai"),this.jsonEditor.session.setMode("ace/mode/json"),this.jsonEditor.setShowPrintMargin(!1),this.jsonEditor.getSession().on("change",function(){e.onJsonEditorChanged()}),this.jsonEditor.getSession().setUseWorker(!0)},t.prototype.initSurvey=function(i){this.surveyValue=new Survey.Survey(i),this.surveyValue.isEmpty&&(this.surveyValue=new Survey.Survey((new e.SurveyJSON5).parse(t.defaultNewSurveyText))),this.survey.mode="designer",this.survey.render(this.surveyjs),this.surveyObjects.survey=this.survey,this.pagesEditor.survey=this.survey,this.pagesEditor.setSelectedPage(this.survey.currentPage),this.surveyVerbs.survey=this.survey;var r=this;this.surveyValue.onSelectedQuestionChanged.add(function(e,t){r.surveyObjects.selectObject(e.selectedQuestionValue)}),this.surveyValue.onCopyQuestion.add(function(e,t){r.copyQuestion(r.koSelectedObject().value)}),this.surveyValue.onCurrentPageChanged.add(function(e,t){r.pagesEditor.setSelectedPage(e.currentPage)}),this.surveyValue.onQuestionAdded.add(function(e,t){r.onQuestionAdded(t.question)}),this.surveyValue.onQuestionRemoved.add(function(e,t){r.onQuestionRemoved(t.question)})},t.prototype.onJsonEditorChanged=function(){if(this.timeoutId>-1&&clearTimeout(this.timeoutId),this.isProcessingImmediately)this.timeoutId=-1;else{var e=this;this.timeoutId=setTimeout(function(){e.timeoutId=-1,e.processJson(e.text)},t.updateTextTimeout)}},t.prototype.processJson=function(t){this.textWorker=new e.SurveyTextWorker(t),this.jsonEditor.getSession().setAnnotations(this.createAnnotations(t,this.textWorker.errors))},t.prototype.doDraggingQuestion=function(t,i){var r=e.SurveyHelper.getNewName(this.survey.getAllQuestions(),"question");new e.DragDropHelper(this.survey).startDragNewQuestion(i,t,r)},t.prototype.doDraggingCopiedQuestion=function(t,i){var r=e.SurveyHelper.getNewName(this.survey.getAllQuestions(),"question");new e.DragDropHelper(this.survey).startDragCopiedQuestion(i,r,t)},t.prototype.doClickQuestion=function(t){var i=e.SurveyHelper.getNewName(this.survey.getAllQuestions(),"question");this.doClickQuestionCore(Survey.QuestionFactory.Instance.createQuestion(t,i))},t.prototype.doClickCopiedQuestion=function(t){var i=e.SurveyHelper.getNewName(this.survey.getAllQuestions(),"question"),r=Survey.QuestionFactory.Instance.createQuestion(t.type,i);(new Survey.JsonObject).toObject(t,r),r.name=i,this.doClickQuestionCore(r)},t.prototype.doClickQuestionCore=function(e){var t=this.survey.currentPage,i=-1;null!=this.survey.selectedQuestionValue&&(i=t.questions.indexOf(this.survey.selectedQuestionValue)+1),t.addQuestion(e,i)},t.prototype.deleteCurrentObject=function(){this.deleteObject(this.koSelectedObject().value)},t.prototype.copyQuestion=function(t){var i=e.SurveyHelper.getObjectType(t);if(i==e.ObjType.Question){var r=(new Survey.JsonObject).toJsonObject(t);r.type=t.getType();var s=this.getCopiedQuestionByName(t.name);s?s.json=r:this.koCopiedQuestions.push({name:t.name,json:r}),this.koCopiedQuestions().length>3&&this.koCopiedQuestions.splice(0,1)}},t.prototype.getCopiedQuestionByName=function(e){for(var t=this.koCopiedQuestions(),i=0;i<t.length;i++)if(t[i].name==e)return t[i];return null},t.prototype.deleteObject=function(t){this.surveyObjects.removeObject(t);var i=e.SurveyHelper.getObjectType(t);i==e.ObjType.Page&&(this.survey.removePage(t),this.pagesEditor.removePage(t)),i==e.ObjType.Question&&(this.survey.currentPage.removeQuestion(t),this.survey.setselectedQuestion(null),this.surveyObjects.selectObject(this.survey.currentPage)),this.survey.render()},t.prototype.showLiveSurvey=function(){if(this.surveyjsExample){var t=this.getSurveyJSON();if(null!=t){var i=new Survey.Survey(t),r=this;i.onComplete.add(function(t){r.surveyjsExample.innerHTML="Survey Result: "+(new e.SurveyJSON5).stringify(i.data)}),i.render(this.surveyjsExample)}else this.surveyjsExample.innerHTML="Please correct JSON!"}},t.prototype.showSurveyEmbeding=function(){var e=this.getSurveyJSON();this.surveyEmbeding.json=e,this.surveyEmbeding.surveyId=this.surveyId,this.surveyEmbeding.surveyPostId=this.surveyPostId,this.surveyEmbeding.show()},t.prototype.getSurveyJSON=function(){return this.koIsShowDesigner()?(new Survey.JsonObject).toJsonObject(this.survey):this.textWorker.isJsonCorrect?(new Survey.JsonObject).toJsonObject(this.textWorker.survey):null},t.prototype.createAnnotations=function(e,t){for(var i=new Array,r=0;r<t.length;r++){var s=t[r],o={row:s.position.start.row,column:s.position.start.column,text:s.text,type:"error"};i.push(o)}return i},t.updateTextTimeout=1e3,t.defaultNewSurveyText="{ pages: [ { name: 'page1'}] }",t}();e.SurveyEditor=t,(new Survey.SurveyTemplateText).replaceText(template_page.html,"page"),(new Survey.SurveyTemplateText).replaceText(template_question.html,"question"),Survey.Survey.prototype.onCreating=function(){this.selectedQuestionValue=null,this.onSelectedQuestionChanged=new Survey.Event,this.onCopyQuestion=new Survey.Event;var e=this;this.copyQuestionClick=function(){e.onCopyQuestion.fire(e)}},Survey.Survey.prototype.setselectedQuestion=function(e){if(e!=this.selectedQuestionValue){var t=this.selectedQuestionValue;this.selectedQuestionValue=e,null!=t&&t.onSelectedQuestionChanged(),null!=this.selectedQuestionValue&&this.selectedQuestionValue.onSelectedQuestionChanged(),this.onSelectedQuestionChanged.fire(this,{oldSelectedQuestion:t,newSelectedQuestion:e})}},Survey.Page.prototype.onCreating=function(){var e=this;this.dragEnterCounter=0,this.koDragging=ko.observable(-1),this.koDragging.subscribe(function(t){0>t&&(e.dragEnterCounter=0)}),this.dragEnter=function(t){t.preventDefault(),e.dragEnterCounter++,e.doDragEnter(t)},this.dragLeave=function(t){e.dragEnterCounter--,0===e.dragEnterCounter&&e.koDragging(-1)},this.dragDrop=function(t){e.doDrop(t)}},Survey.Page.prototype.doDrop=function(t){new e.DragDropHelper(this.data).doDrop(t)},Survey.Page.prototype.doDragEnter=function(t){this.questions.length>0||this.koDragging()>0||new e.DragDropHelper(this.data).isSurveyDragging(t)&&this.koDragging(this.questions.length)},Survey.QuestionBase.prototype.onCreating=function(){var t=this;this.dragDropHelperValue=null,this.dragDropHelper=function(){return null==this.dragDropHelperValue&&(this.dragDropHelperValue=new e.DragDropHelper(this.data)),this.dragDropHelperValue},this.dragOver=function(e){t.dragDropHelper().doDragDropOver(e,t)},this.dragDrop=function(e){t.dragDropHelper().doDrop(e,t)},this.dragStart=function(e){t.dragDropHelper().startDragQuestion(e,t.name)},this.koIsSelected=ko.observable(!1),this.koOnClick=function(){null!=t.data&&t.data.setselectedQuestion(this)}},Survey.QuestionBase.prototype.onSelectedQuestionChanged=function(){null!=this.data&&this.koIsSelected(this.data.selectedQuestionValue==this)}}(SurveyEditor||(SurveyEditor={}));var SurveyEditor;!function(e){var t=function(){function e(e){void 0===e&&(e=0),this.parseType=e}return e.prototype.parse=function(e,t,i,r){void 0===t&&(t=null),void 0===i&&(i=0),void 0===r&&(r=-1);var s;return this.text=String(e),this.at=i,this.endAt=r,this.ch=" ",s=this.value(),this.white(),this.ch&&this.error("Syntax error"),"function"==typeof t?function o(e,i){var r,s,n=e[i];if(n&&"object"==typeof n)for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(s=o(n,r),void 0!==s?n[r]=s:delete n[r]);return t.call(e,i,n)}({"":s},""):s},e.prototype.error=function(e){var t=new SyntaxError;throw t.message=e,t.at=this.at,t},e.prototype.next=function(e){return void 0===e&&(e=null),e&&e!==this.ch&&this.error("Expected '"+e+"' instead of '"+this.ch+"'"),this.ch=this.chartAt(),this.at+=1,this.ch},e.prototype.peek=function(){return this.chartAt()},e.prototype.chartAt=function(){return this.endAt>-1&&this.at>=this.endAt?"":this.text.charAt(this.at)},e.prototype.identifier=function(){var e=this.ch;for("_"!==this.ch&&"$"!==this.ch&&(this.ch<"a"||this.ch>"z")&&(this.ch<"A"||this.ch>"Z")&&this.error("Bad identifier");this.next()&&("_"===this.ch||"$"===this.ch||this.ch>="a"&&this.ch<="z"||this.ch>="A"&&this.ch<="Z"||this.ch>="0"&&this.ch<="9");)e+=this.ch;return e},e.prototype.number=function(){var e,t="",i="",r=10;if(("-"===this.ch||"+"===this.ch)&&(t=this.ch,this.next(this.ch)),"I"===this.ch)return e=this.word(),("number"!=typeof e||isNaN(e))&&this.error("Unexpected word for number"),"-"===t?-e:e;if("N"===this.ch)return e=this.word(),isNaN(e)||this.error("expected word to be NaN"),e;switch("0"===this.ch&&(i+=this.ch,this.next(),"x"===this.ch||"X"===this.ch?(i+=this.ch,this.next(),r=16):this.ch>="0"&&this.ch<="9"&&this.error("Octal literal")),r){case 10:for(;this.ch>="0"&&this.ch<="9";)i+=this.ch,this.next();if("."===this.ch)for(i+=".";this.next()&&this.ch>="0"&&this.ch<="9";)i+=this.ch;if("e"===this.ch||"E"===this.ch)for(i+=this.ch,this.next(),("-"===this.ch||"+"===this.ch)&&(i+=this.ch,this.next());this.ch>="0"&&this.ch<="9";)i+=this.ch,this.next();break;case 16:for(;this.ch>="0"&&this.ch<="9"||this.ch>="A"&&this.ch<="F"||this.ch>="a"&&this.ch<="f";)i+=this.ch,this.next()}return e="-"===t?-i:+i,isFinite(e)?e:void this.error("Bad number")},e.prototype.string=function(){var t,i,r,s,o="";if('"'===this.ch||"'"===this.ch)for(r=this.ch;this.next();){if(this.ch===r)return this.next(),o;if("\\"===this.ch)if(this.next(),"u"===this.ch){for(s=0,i=0;4>i&&(t=parseInt(this.next(),16),isFinite(t));i+=1)s=16*s+t;o+=String.fromCharCode(s)}else if("\r"===this.ch)"\n"===this.peek()&&this.next();else{if("string"!=typeof e.escapee[this.ch])break;o+=e.escapee[this.ch]}else{if("\n"===this.ch)break;o+=this.ch}}this.error("Bad string")},e.prototype.inlineComment=function(){"/"!==this.ch&&this.error("Not an inline comment");do if(this.next(),"\n"===this.ch||"\r"===this.ch)return void this.next();while(this.ch)},e.prototype.blockComment=function(){"*"!==this.ch&&this.error("Not a block comment");do for(this.next();"*"===this.ch;)if(this.next("*"),"/"===this.ch)return void this.next("/");while(this.ch);this.error("Unterminated block comment")},e.prototype.comment=function(){"/"!==this.ch&&this.error("Not a comment"),this.next("/"),"/"===this.ch?this.inlineComment():"*"===this.ch?this.blockComment():this.error("Unrecognized comment")},e.prototype.white=function(){for(;this.ch;)if("/"===this.ch)this.comment();else{if(!(e.ws.indexOf(this.ch)>=0))return;this.next()}},e.prototype.word=function(){switch(this.ch){case"t":return this.next("t"),this.next("r"),this.next("u"),this.next("e"),!0;case"f":return this.next("f"),this.next("a"),this.next("l"),this.next("s"),this.next("e"),!1;case"n":return this.next("n"),this.next("u"),this.next("l"),this.next("l"),null;case"I":return this.next("I"),this.next("n"),this.next("f"),this.next("i"),this.next("n"),this.next("i"),this.next("t"),this.next("y"),1/0;case"N":return this.next("N"),this.next("a"),this.next("N"),0/0}this.error("Unexpected '"+this.ch+"'")},e.prototype.array=function(){var e=[];if("["===this.ch)for(this.next("["),this.white();this.ch;){if("]"===this.ch)return this.next("]"),e;if(","===this.ch?this.error("Missing array element"):e.push(this.value()),this.white(),","!==this.ch)return this.next("]"),e;this.next(","),this.white()}this.error("Bad array")},e.prototype.object=function(){var t,i,r=!0,s={};if(this.parseType>0&&(s[e.positionName]={start:this.at-1}),"{"===this.ch)for(this.next("{"),this.white(),i=this.at-1;this.ch;){if("}"===this.ch)return this.parseType>0&&(s[e.positionName].end=i),this.next("}"),s;if(t='"'===this.ch||"'"===this.ch?this.string():this.identifier(),this.white(),this.parseType>1&&(s[e.positionName][t]={start:i,valueStart:this.at}),this.next(":"),s[t]=this.value(),this.parseType>1&&(i=this.at-1,s[e.positionName][t].valueEnd=i,s[e.positionName][t].end=i),this.white(),","!==this.ch)return this.parseType>1&&(s[e.positionName][t].valueEnd--,s[e.positionName][t].end--),this.parseType>0&&(s[e.positionName].end=this.at-1),this.next("}"),s;this.parseType>1&&(s[e.positionName][t].valueEnd--,r||s[e.positionName][t].end--),this.next(","),this.white(),r=!1}this.error("Bad object")},e.prototype.value=function(){switch(this.white(),this.ch){case"{":return this.object();case"[":return this.array();case'"':case"'":return this.string();case"-":case"+":case".":return this.number();default:return this.ch>="0"&&this.ch<="9"?this.number():this.word()}},e.prototype.stringify=function(e,t,i){if(void 0===t&&(t=null),void 0===i&&(i=null),t&&"function"!=typeof t&&!this.isArray(t))throw new Error("Replacer must be a function or an array");this.replacer=t,this.indentStr=this.getIndent(i),this.objStack=[];var r={"":e};return void 0===e?this.getReplacedValueOrUndefined(r,"",!0):this.internalStringify(r,"",!0)},e.prototype.getIndent=function(e){if(e){if("string"==typeof e)return e;if("number"==typeof e&&e>=0)return this.makeIndent(" ",e,!0)}return""},e.prototype.getReplacedValueOrUndefined=function(e,t,i){var r=e[t];return r&&r.toJSON&&"function"==typeof r.toJSON&&(r=r.toJSON()),"function"==typeof this.replacer?this.replacer.call(e,t,r):this.replacer?i||this.isArray(e)||this.replacer.indexOf(t)>=0?r:void 0:r},e.prototype.isWordChar=function(e){return e>="a"&&"z">=e||e>="A"&&"Z">=e||e>="0"&&"9">=e||"_"===e||"$"===e},e.prototype.isWordStart=function(e){return e>="a"&&"z">=e||e>="A"&&"Z">=e||"_"===e||"$"===e},e.prototype.isWord=function(e){if("string"!=typeof e)return!1;if(!this.isWordStart(e[0]))return!1;for(var t=1,i=e.length;i>t;){if(!this.isWordChar(e[t]))return!1;t++}return!0},e.prototype.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)},e.prototype.isDate=function(e){return"[object Date]"===Object.prototype.toString.call(e)},e.prototype.isNaN=function(e){return"number"==typeof e&&e!==e},e.prototype.checkForCircular=function(e){for(var t=0;t<this.objStack.length;t++)if(this.objStack[t]===e)throw new TypeError("Converting circular structure to JSON")},e.prototype.makeIndent=function(e,t,i){if(void 0===i&&(i=!1),!e)return"";e.length>10&&(e=e.substring(0,10));for(var r=i?"":"\n",s=0;t>s;s++)r+=e;return r},e.prototype.escapeString=function(t){return e.escapable.lastIndex=0,e.escapable.test(t)?'"'+t.replace(e.escapable,function(t){var i=e.meta[t];return"string"==typeof i?i:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'},e.prototype.internalStringify=function(e,t,i){var r,s,o=this.getReplacedValueOrUndefined(e,t,i);switch(o&&!this.isDate(o)&&(o=o.valueOf()),typeof o){case"boolean":return o.toString();case"number":return isNaN(o)||!isFinite(o)?"null":o.toString();case"string":return this.escapeString(o.toString());case"object":if(null===o)return"null";if(this.isArray(o)){this.checkForCircular(o),r="[",this.objStack.push(o);for(var n=0;n<o.length;n++)s=this.internalStringify(o,n,!1),r+=this.makeIndent(this.indentStr,this.objStack.length),r+=null===s||"undefined"==typeof s?"null":s,n<o.length-1?r+=",":this.indentStr&&(r+="\n");this.objStack.pop(),r+=this.makeIndent(this.indentStr,this.objStack.length,!0)+"]"}else{this.checkForCircular(o),r="{";var a=!1;this.objStack.push(o);for(var u in o)if(o.hasOwnProperty(u)){var l=this.internalStringify(o,u,!1);if(i=!1,"undefined"!=typeof l&&null!==l){r+=this.makeIndent(this.indentStr,this.objStack.length),a=!0;var d=this.isWord(u)?u:this.escapeString(u);r+=d+":"+(this.indentStr?" ":"")+l+","}}this.objStack.pop(),r=a?r.substring(0,r.length-1)+this.makeIndent(this.indentStr,this.objStack.length)+"}":"{}"}return r;default:return void 0}},e.positionName="pos",e.escapee={"'":"'",'"':'"',"\\":"\\","/":"/","\n":"",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},e.ws=[" ","	","\r","\n","","\f"," ","\ufeff"],e.cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e.escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e.meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},e}();e.SurveyJSON5=t}(SurveyEditor||(SurveyEditor={}));var SurveyEditor;!function(e){var t=function(){function e(){}return e}();e.SurveyObjectItem=t;var i=function(){function i(e,t){this.koObjects=e,this.koSelected=t}return Object.defineProperty(i.prototype,"survey",{get:function(){return this.surveyValue},set:function(e){this.survey!=e&&(this.surveyValue=e,this.rebuild())},enumerable:!0,configurable:!0}),i.prototype.addPage=function(e){var t=this.createPage(e),i=this.survey.pages.indexOf(e);if(i>0){var r=this.survey.pages[i-1];i=this.getItemIndex(r)+1,i+=r.questions.length}else i=1;this.addItem(t,i),i++;for(var s=0;s<e.questions.length;s++){var o=this.createQuestion(e.questions[s]);this.addItem(o,i+s)}this.koSelected(t)},i.prototype.addQuestion=function(e,t){var i=this.getItemIndex(e);if(!(0>i)){var r=e.questions.indexOf(t)+1;i+=r;var s=this.createQuestion(t);this.addItem(s,i),this.koSelected(s)}},i.prototype.selectObject=function(e){for(var t=this.koObjects(),i=0;i<t.length;i++)if(t[i].value==e)return void this.koSelected(t[i])},i.prototype.removeObject=function(t){var i=this.getItemIndex(t);if(!(0>i)){var r=1;if(e.SurveyHelper.getObjectType(t)==e.ObjType.Page){var s=t;r+=s.questions.length}this.koObjects.splice(i,r)}},i.prototype.nameChanged=function(e){var t=this.getItemIndex(e);0>t||this.koObjects()[t].text(this.getText(e))},i.prototype.addItem=function(e,t){t>this.koObjects().length?this.koObjects.push(e):this.koObjects.splice(t,0,e)},i.prototype.rebuild=function(){var e=[];if(null==this.survey)return this.koObjects(e),void this.koSelected(null);e.push(this.createItem(this.survey,"Survey"));for(var t=0;t<this.survey.pages.length;t++){var i=this.survey.pages[t];e.push(this.createPage(i));for(var r=0;r<i.questions.length;r++)e.push(this.createQuestion(i.questions[r]))}this.koObjects(e),this.koSelected(this.survey)},i.prototype.createPage=function(e){return this.createItem(e,this.getText(e))},i.prototype.createQuestion=function(e){return this.createItem(e,this.getText(e))},i.prototype.createItem=function(e,i){var r=new t;return r.value=e,r.text=ko.observable(i),r},i.prototype.getItemIndex=function(e){for(var t=this.koObjects(),i=0;i<t.length;i++)if(t[i].value==e)return i;return-1},i.prototype.getText=function(t){var r=i.intend;return e.SurveyHelper.getObjectType(t)!=e.ObjType.Page&&(r+=i.intend),r+e.SurveyHelper.getObjectName(t)},i.intend="...",i}();e.SurveyObjects=i}(SurveyEditor||(SurveyEditor={}));